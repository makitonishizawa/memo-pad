<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>英単語帳</title>
    <script src="js/jquery-2.1.3.min.js"></script>
    <link rel="stylesheet" href="css/style.css">

</head>

<body>

    <header>
        <h1 id="top">英単語帳</h1>
    </header>

    <main style="display:none;">
        <textarea id="text_area" placeholder="英単語"></textarea>
        <textarea id="text_area2" placeholder="意味"></textarea>
        <ul>
            <li id="save">保存</li>
            <li id="clear">削除</li>
            <li id="answer">答え</li>
        </ul>
       
        <div id="test">テスト ↓正しい答えを選んでください↓ </div>
        <div id="question"></div>

        <div id="sentakushi">
            <button id="sentaku1"></button>
            <button id="sentaku2"></button>
            <button id="sentaku3"></button>
        </div>
    
        <div id="hantei">
            <!-- <button id="right">正解</button> -->
            <!-- <button id="wrong">不正解</button> -->
            <button id="next">Next</button>
        </div>

        <div id="hantei2"></div>

        <div id="kekka">
            <h1 id="title">正解率:</h1>
            <h1 id="seikairitsu"></h1>
        </div>

    </main>

    <script>
        var seikai =0
        var fuseikai =0

        $("main").slideDown(500);
        $("#title").hide();
        
        //1.Save クリックイベント
        $("#save").on("click", function(){
            const word= $("#text_area").val();
            const mean= $("#text_area2").val();
            var dataToSave = JSON.stringify([mean, 0, 0, 0]);
            localStorage.setItem(word,dataToSave);
            alert("saveしました")
        })

        //2.clear クリックイベント
        $("#clear").on("click", function(){
            const word= $("#text_area").val();
            localStorage.removeItem(word);
            alert("clearしました")
            $("#text_area").val("");
        })

        //3.ページ読み込み：保存データ取得表示
        $("#answer").on("click", function(){
            
            const word= $("#text_area").val();
            if(localStorage.getItem(word)){
                const str = localStorage.getItem(word);
                var storedValue = JSON.parse(str);
                $("#text_area2").val(storedValue[0]);
                console.dir(storedValue[0])
            }
        })

        //4.正解数保存
        $("#right").on("click", function(){
            const word= $("#text_area").val();
            const mean= $("#text_area2").val();
            const str = localStorage.getItem(word);
            var storedValue = JSON.parse(str)
            seikai = storedValue[1]
            fuseikai = storedValue[2]
            seikai= seikai+1
            seikairitsu = seikai/(seikai + fuseikai)
            var array =[mean,seikai,fuseikai,seikairitsu];
            console.dir(array)
            var total = JSON.stringify(array);
            localStorage.setItem(word,total)
            console.dir(total)
            
            if(localStorage.getItem(word)){
                const str = localStorage.getItem(word);
                var storedValue = JSON.parse(str);
                $("#text_area2").val(storedValue[0]);
                console.dir(storedValue[0])
            }
            let round = Math.round(storedValue[3]*100)
            $("#seikairitsu").html(round + "%")
            $("#title").show()

        })
        $("#wrong").on("click", function(){
            const word= $("#text_area").val();
            const mean= $("#text_area2").val();
            const str = localStorage.getItem(word);
            var storedValue = JSON.parse(str)
            seikai = storedValue[1]
            fuseikai = storedValue[2]
            fuseikai= fuseikai+1
            seikairitsu = seikai/(seikai + fuseikai)
            var array =[mean,seikai,fuseikai,seikairitsu];
            console.dir(array)
            var total = JSON.stringify(array);
            localStorage.setItem(word,total)
            console.dir(total)

            if(localStorage.getItem(word)){
                const str = localStorage.getItem(word);
                var storedValue = JSON.parse(str);
                $("#text_area2").val(storedValue[0]);
                console.dir(storedValue[0])
            }
            let round = Math.round(storedValue[3]*100)
            $("#seikairitsu").html(round + "%")
            $("#title").show()

        })

        // 次の問題へ
        $(document).ready(function() {
            function getRandomLocalStorageKey() {
                var keys = Object.keys(localStorage);
                if (keys.length === 0) {
                    return null;
                }
                var randomIndex = Math.floor(Math.random() * keys.length);
                return keys[randomIndex];
            }
            //LocalStorage内の単語をテキストボックスに表示
            $('#next').on('click', function() {
                $("#hantei2").hide()
                $("#kekka").hide()

                $('#text_area2').val("")
                var randomKey = getRandomLocalStorageKey();
                $('#text_area').text(randomKey ? randomKey : "LocalStorageが空です。");
                console.log(randomKey)
            
            //対応する意味を表示
                const str2 = localStorage.getItem(randomKey);
                var storedValue2 = JSON.parse(str2);
                
            //ダミー１ 
            var keys = Object.keys(localStorage);
                if (keys.length === 0) {
                    return null;
                }    
            var dummy1 = Math.floor(Math.random()*keys.length)
            var randomKey2 = getRandomLocalStorageKey();
            const str3 = localStorage.getItem(randomKey2);
            var storedValue3 = JSON.parse(str3);
            console.log(keys.length)
    
                
            //ダミー2
                var dummy2 = Math.floor(Math.random()*keys.length)
                var randomKey3 = getRandomLocalStorageKey();
                const str4 = localStorage.getItem(randomKey3);
                var storedValue4 = JSON.parse(str4);
                
            //ランダム数値発生させ、ボックスに引き込む
                var random =Math.floor(Math.random()*3)
                    if (random == 0){
                        $("#sentaku1").html(storedValue2[0]);
                        $("#sentaku2").html(storedValue3[0]);
                        $("#sentaku3").html(storedValue4[0]);

                    }else if (random == 1){
                        $("#sentaku1").html(storedValue4[0]);
                        $("#sentaku2").html(storedValue2[0]);
                        $("#sentaku3").html(storedValue3[0]);
                    }else {
                        $("#sentaku1").html(storedValue3[0]);
                        $("#sentaku2").html(storedValue4[0]);
                        $("#sentaku3").html(storedValue2[0]);
                    }
                            console.log(random);  
        
                // ボタン1をクリック
                $('#sentaku1').on('click', function() {
                    const word= $("#text_area").val();
                    if(localStorage.getItem(word)){
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str);
                        $("#text_area2").val(storedValue[0]);
                        console.dir(storedValue[0])
                    }
                    if(random ==0){    
                        const word= $("#text_area").val();
                        const mean= $("#text_area2").val();
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str)
                        seikai = storedValue[1]
                        fuseikai = storedValue[2]
                        seikai= seikai+1
                        seikairitsu = seikai/(seikai + fuseikai)
                        var array =[mean,seikai,fuseikai,seikairitsu];
                        console.dir(array)
                        var total = JSON.stringify(array);
                        localStorage.setItem(word,total)
                        console.dir(total)
                    
                        if(localStorage.getItem(word)){
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str);
                        $("#text_area2").val(storedValue[0]);
                        console.dir(storedValue[0])
                        }
                        let round = Math.round(storedValue[3]*100)
                        $("#seikairitsu").html(round + "%")
                        $("#seikairitsu").show()
                        $("#title").show()
                        $("#hantei2").html("正解")
                        $("#hantei2").show()
                        $("#kekka").show()
                        console.log(round)

                    }else{
                        const word= $("#text_area").val();
                        const mean= $("#text_area2").val();
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str)
                        seikai = storedValue[1]
                        fuseikai = storedValue[2]
                        fuseikai= fuseikai+1
                        seikairitsu = seikai/(seikai + fuseikai)
                        var array =[mean,seikai,fuseikai,seikairitsu];
                        console.dir(array)
                        var total = JSON.stringify(array);
                        localStorage.setItem(word,total)
                        console.dir(total)

                        if(localStorage.getItem(word)){
                            const str = localStorage.getItem(word);
                            var storedValue = JSON.parse(str);
                            $("#text_area2").val(storedValue[0]);
                            console.dir(storedValue[0])
                        }
                        let round = Math.round(storedValue[3]*100)
                        $("#seikairitsu").html(round + "%")
                        $("#seikairitsu").show()
                        $("#title").show()
                        $("#hantei2").html("不正解")
                        $("#hantei2").show()
                        $("#kekka").show()
                        console.log(round)      
                    }

                })

                 // ボタン2をクリック
                 $('#sentaku2').on('click', function() {
                    const word= $("#text_area").val();
                    if(localStorage.getItem(word)){
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str);
                        $("#text_area2").val(storedValue[0]);
                        console.dir(storedValue[0])
                    }
                    
                    if(random ==1){
                        const word= $("#text_area").val();
                        const mean= $("#text_area2").val();
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str)
                        seikai = storedValue[1]
                        fuseikai = storedValue[2]
                        seikai= seikai+1
                        seikairitsu = seikai/(seikai + fuseikai)
                        var array =[mean,seikai,fuseikai,seikairitsu];
                        console.dir(array)
                        var total = JSON.stringify(array);
                        localStorage.setItem(word,total)
                        console.dir(total)
                    
                        if(localStorage.getItem(word)){
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str);
                        $("#text_area2").val(storedValue[0]);
                        console.dir(storedValue[0])
                        }
                        let round = Math.round(storedValue[3]*100)
                        $("#seikairitsu").html(round + "%")
                        $("#seikairitsu").show()
                        $("#title").show()
                        $("#hantei2").html("正解")
                        $("#hantei2").show()
                        $("#kekka").show()
                       

                    }else{
                        const word= $("#text_area").val();
                        const mean= $("#text_area2").val();
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str)
                        seikai = storedValue[1]
                        fuseikai = storedValue[2]
                        fuseikai= fuseikai+1
                        seikairitsu = seikai/(seikai + fuseikai)
                        var array =[mean,seikai,fuseikai,seikairitsu];
                        console.dir(array)
                        var total = JSON.stringify(array);
                        localStorage.setItem(word,total)
                        console.dir(total)

                        if(localStorage.getItem(word)){
                            const str = localStorage.getItem(word);
                            var storedValue = JSON.parse(str);
                            $("#text_area2").val(storedValue[0]);
                            console.dir(storedValue[0])
                        }
                        let round = Math.round(storedValue[3]*100)
                        $("#seikairitsu").html(round + "%")
                        $("#seikairitsu").show()
                        $("#title").show()
                        $("#hantei2").html("不正解")
                        $("#hantei2").show() 
                        $("#kekka").show()     
                    }
                })

                // ボタン3をクリック
                $('#sentaku3').on('click', function() {
                    const word= $("#text_area").val();
                    if(localStorage.getItem(word)){
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str);
                        $("#text_area2").val(storedValue[0]);
                        console.dir(storedValue[0])
                    }
                    
                    if(random ==2){
                        const word= $("#text_area").val();
                        const mean= $("#text_area2").val();
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str)
                        seikai = storedValue[1]
                        fuseikai = storedValue[2]
                        seikai= seikai+1
                        seikairitsu = seikai/(seikai + fuseikai)
                        var array =[mean,seikai,fuseikai,seikairitsu];
                        console.dir(array)
                        var total = JSON.stringify(array);
                        localStorage.setItem(word,total)
                        console.dir(total)
                    
                        if(localStorage.getItem(word)){
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str);
                        $("#text_area2").val(storedValue[0]);
                        console.dir(storedValue[0])
                        }
                        let round = Math.round(storedValue[3]*100)
                        $("#seikairitsu").html(round + "%")
                        $("#seikairitsu").show()
                        $("#title").show()
                        $("#hantei2").html("正解")
                        $("#hantei2").show()
                        $("#kekka").show()

                    }else{
                        const word= $("#text_area").val();
                        const mean= $("#text_area2").val();
                        const str = localStorage.getItem(word);
                        var storedValue = JSON.parse(str)
                        seikai = storedValue[1]
                        fuseikai = storedValue[2]
                        fuseikai= fuseikai+1
                        seikairitsu = seikai/(seikai + fuseikai)
                        var array =[mean,seikai,fuseikai,seikairitsu];
                        console.dir(array)
                        var total = JSON.stringify(array);
                        localStorage.setItem(word,total)
                        console.dir(total)

                        if(localStorage.getItem(word)){
                            const str = localStorage.getItem(word);
                            var storedValue = JSON.parse(str);
                            $("#text_area2").val(storedValue[0]);
                            console.dir(storedValue[0])
                        }
                        let round = Math.round(storedValue[3]*100)
                        $("#seikairitsu").html(round + "%")
                        $("#seikairitsu").show()
                        $("#title").show()
                        $("#hantei2").html("不正解")
                        $("#hantei2").show() 
                        $("#kekka").show()     
                    }

                })

            });

        });
        //ロード時に表示
        //※こんなこともできる例
    </script>
</body>

</html>